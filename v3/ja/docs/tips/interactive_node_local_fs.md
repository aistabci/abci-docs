
# インタラクティブノードの/localの利用

ABCIのインタラクティブノードでは、ローカルスクラッチ領域として、/localが利用可能です。

## /localの構造

/localには、ユーザ領域(グループ用ディレクトリ)の他に、システムで使用する領域があり、それぞれ以下の様になっています。

| パス | 区分 | 用途 |
| :-- | :-- | :-- |
| /local/groups | ユーザ領域 | グループ用ディレクトリ |
| /local/pcc.groups | システム領域 | LPCC用ディレクトリ(LPCC: Hierarchical Persistent Client Caching for Lustre) |

グループ用ディレクトリは/local/groupsの下に作成されます。

## グループディレクトリ

各グループディレクトリは、/local/groupsの下に作成され、所有者はroot、グループはグループID、パーミッションは02770(rwxrws---)に設定されています。
例えば、グループgxa00001のグループディレクトリは、/local/groups/gxa00001です。

```
[username@login1 ~]$ ls -ld /local/groups/gxa00001
drwxrws--- 5 root gxa00001 4096 Dec 15  2025 /groups/gxa00001
```

パーミッションにset-group-IDが設定されているので、グループディレクトリに新規作成されるファイルのグループIDは、親ディレクトリのグループIDを継承します。

## 使用制限(クォータ)

各グループディレクトリには、無制限の使用を防止する為、XFSのプロジェクト・クォータが掛けられています。

| 種類 | 制限値 | 説明 |
| :-- | :-- | :-- |
| bhard | 1TB | 使用可能ブロック数のハード制限。ユーザは制限値を超えるブロックを使用出来ません。 |
| bsoft | なし | 使用可能ブロック数のソフト制限。ユーザは制限値を超えるブロックを一時的に使用出来ます。 |
| ihard | なし | 使用可能inode数のハード制限。ユーザは制限値を超えるブロックを使用出来ません。 |
| isoft | なし | 使用可能inode数のソフト制限。ユーザは制限値を超えるinode数を一時的に使用出来ます。 |

bhard制限により、各グループディレクトリに存在するファイルの総使用量が1TBを超えることは出来ません。
超過すると、ENOSPCエラー(No space left on device (POSIX.1-2001))が発生します。

bhard制限に引っかからない様、利用してください。
もしbhard制限に引っ掛かった場合は、古いファイルや不要なファイルを削除してください。

## 使用量の確認方法

duコマンドを使用して、グループディレクトリの使用量を確認してください。

例:
```
[username@login1 ~]$ du -sk /local/groups/gxa00001
```

## 自動ファイル削除

/localの使用量を適正化する為、/localの使用率を定期的に監視し、閾値を超えたら古いファイルを削除します。

現状、毎時0分に/localの使用率を取得し、75%より大きい場合は、アクセス日時が7日より古いファイルを全て削除します。
!!!note
    削除中に使用率が一定以下に下がっても、途中で削除を止めることはありません。
    その代わり、使用率が75%を超えない限り、古いファイルが削除されることはありません。

<!--
| 項目 | 設定値 | 説明 |
| :-- | :-- | :-- |
| 監視間隔 | 毎時0分 | 毎時0分に/localの使用率監視プログラムが実行されます。 |
| 閾値 | 75% | /localの使用率が設定値より大きくなったら、自動ファイル削除が行われます。 |
| 削除基準 | アクセス日が7日より古いファイル | 自動ファイル削除は、アクセス日時が7日より古いファイルを全て削除します。 |
-->


## ファイルのアクセス日時の確認方法

ファイルのアクセス日時は、以下の方法で確認することが出来ます。

(1) statを使う方法

```
$ stat ファイル名
```

例:
```
[username@login1 gxa00001]$ stat junk
  File: junk
  Size: 0         	Blocks: 0          IO Block: 4194304 regular empty file
Device: 84f0b5a2h/2230367650d	Inode: 270216711578435798  Links: 1
Access: (0640/-rw-r-----)  Uid: (18180/ach18180se)   Gid: (18180/ach18180se)
Access: 2025-12-15 15:14:46.000000000 +0900
Modify: 2025-12-15 15:14:29.000000000 +0900
Change: 2025-12-15 15:14:40.000000000 +0900
 Birth: 2025-12-15 15:10:15.000000000 +0900
```

Access:行がアクセス日時です。

(2) lsを使う方法

```
$ ls -l -u ファイル名
```

-uオプションを指定することで、更新日時ではなく、アクセス日時が表示されます。

例: アクセス日時を表示する。
```
[username@login1 gxa00001]$ ls -l -u junk
-rw-r----- 1 ach18180se ach18180se 0 Dec 15 15:14 junk
```

参考: 更新日時を表示する。
```
[username@login1 gxa00001]$ ls -l junk
-rw-r----- 1 ach18180se ach18180se 0 Dec 15 15:14 junk
```

上記の例ではアクセス日時と更新日時の違いが分かりませんが、その場合は--full-timeオプションを指定すると完全な日時が表示され、区別可能になります。

例: 完全なアクセス日時を表示する。
```
[username@login1 gxa00001]$ ls -l -u --full-time junk
-rw-r----- 1 ach18180se ach18180se 0 2025-12-15 15:14:46.000000000 +0900 junk
```

参考: 完全な更新日時を表示する。
```
[username@login1 gxa00001]$ ls -l --full-time junk
-rw-r----- 1 ach18180se ach18180se 0 2025-12-15 15:14:29.000000000 +0900 junk
```
